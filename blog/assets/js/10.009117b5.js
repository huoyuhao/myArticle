(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{364:function(s,t,a){"use strict";a.r(t);var n=a(25),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"升级服务器http2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#升级服务器http2"}},[s._v("#")]),s._v(" 升级服务器HTTP2")]),s._v(" "),a("h2",{attrs:{id:"获取https证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取https证书"}},[s._v("#")]),s._v(" 获取HTTPS证书")]),s._v(" "),a("p",[s._v("可以使用网上"),a("a",{attrs:{href:"https://freessl.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("免费生成证书网站"),a("OutboundLink")],1)]),s._v(" "),a("ol",[a("li",[a("p",[s._v("输入需要生成的网站名称和邮箱\n证书品牌，证书类型等选项选择默认就好。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/%E7%94%9F%E6%88%90HTTPS%E8%AF%81%E4%B9%A6-1.png",alt:"生成HTTPS证书"}})])]),s._v(" "),a("li",[a("p",[s._v("根据提示下载软件KeyManager进行安装，并注册账号")])]),s._v(" "),a("li",[a("p",[s._v("重新在网站上点击【点击创建】按钮，打开KeyManager软件，提示【CSR生成成功，请返回浏览器继续操作】")])]),s._v(" "),a("li",[a("p",[s._v("返回浏览器看到DNS验证内容如下")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/%E7%94%9F%E6%88%90HTTPS%E8%AF%81%E4%B9%A6-2.png",alt:"生成HTTPS证书"}})])]),s._v(" "),a("li",[a("p",[s._v("到我们购买域名的服务商处配置DNS域名解析")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/%E7%94%9F%E6%88%90HTTPS%E8%AF%81%E4%B9%A6-3.png",alt:"生成HTTPS证书"}})])]),s._v(" "),a("li",[a("p",[s._v("点击【配置完成，检测一下】，打开新的页面，点击【检测】，如果提示不匹配，可能是DNS解析还没有生效，多等一会就好了")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/%E7%94%9F%E6%88%90HTTPS%E8%AF%81%E4%B9%A6-4.png",alt:"生成HTTPS证书"}})])]),s._v(" "),a("li",[a("p",[s._v("点击【点击验证】，返回证书信息，点击保存到KeyManager")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/%E7%94%9F%E6%88%90HTTPS%E8%AF%81%E4%B9%A6-5.png",alt:"生成HTTPS证书"}})])]),s._v(" "),a("li",[a("p",[s._v("我们可以在KeyManager中查看证书内容")])]),s._v(" "),a("li",[a("p",[s._v("点击【导出证书】，选择服务器Nginx，导出证书文件。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/%E7%94%9F%E6%88%90HTTPS%E8%AF%81%E4%B9%A6-6.png",alt:"生成HTTPS证书"}})])]),s._v(" "),a("li",[a("p",[s._v("解压到处的文件包，获得2个文件 XX.crt 和 XX.key")])])]),s._v(" "),a("h2",{attrs:{id:"安装https证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装https证书"}},[s._v("#")]),s._v(" 安装HTTPS证书")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("先把刚才获得的两个证书上传到自己的服务器上，我是上传到"),a("code",[s._v("/www/SSL/")]),s._v("目录下。")])]),s._v(" "),a("li",[a("p",[s._v("打开Nginx配置文件，目录"),a("code",[s._v("/etc/nginx/conf.d/default.conf")]),s._v("，如果没有新建一个，以"),a("code",[s._v(".conf")]),s._v("结尾")])]),s._v(" "),a("li",[a("p",[s._v("然后将下面的配置内容填写进去")])])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  # 侦听"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("端口，这个是ssl访问端口\n  listen    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  # 定义使用 访问域名\n  server_name  www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("huoyuhao"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("net"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  #定义服务器的默认网站根目录位置\n  root "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("blog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  # 刚才获取证书中"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt结尾文件的位置 相对服务器绝对路径\n  ssl_certificate     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/www/SSL/www.huoyuhao.net_chain.crt"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  # 刚才获取证书中"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key结尾文件的位置\n  ssl_certificate_key "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/www/SSL/www.huoyuhao.net_key.key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  # 储存"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SSL")]),s._v("会话的缓存类型和大小\n  ssl_session_cache   shared"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SSL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  # 会话过期时间\n  ssl_session_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  # 按照这个协议配置\n  ssl_protocols       TLSv1 TLSv1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" TLSv1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  # 为建立安全连接，服务器所允许的密码格式列表  按照这个套件配置\n  ssl_ciphers         "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ECDHE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RSA")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AES128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GCM")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHA256")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HIGH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("aNULL"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MD5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RC4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DHE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ssl_prefer_server_ciphers   on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  # 默认请求\n  location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    root "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("blog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    #定义首页索引文件的名称\n    index index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    try_files $uri $uri"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  # 静态文件，nginx自己处理\n  location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("images"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("javascript"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("js"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("flash"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("media"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    # 过期"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("天，静态文件不怎么更新，过期可以设大一点，\n    # 如果频繁更新，则可以设置得小一点。\n    expires "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  # "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("端口是http正常访问的接口\n  listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  server_name www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("huoyuhao"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("net"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  # 在这里，我做了https全加密处理，在访问http的时候自动跳转到https\n  rewrite "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$host$"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" permanent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br")])]),a("h2",{attrs:{id:"重启nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启nginx"}},[s._v("#")]),s._v(" 重启Nginx")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 查看nginx配置文件是否有报错")]),s._v("\nnginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s reload "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// nginx服务重新启动")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"nginx配置http2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置http2"}},[s._v("#")]),s._v(" nginx配置http2")]),s._v(" "),a("p",[s._v("这一步非常简单，修改上面nginx配置文件如下：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  listen    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl http2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("重启nginx服务即可")])])}),[],!1,null,null,null);t.default=r.exports}}]);