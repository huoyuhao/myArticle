---
meta:
  - name: description
    content: 从输入URL到页面展示
  - name: keywords
    content: 从输入URL到页面展示,URL,页面渲染,前端,
---
# 从输入URL到页面展示

从URL到页面展示都经历了那些内容？我先把结果放出来，之后在一章一章的具体介绍相应的知识点

## 用户输入

+ 用户输入内容，点击回车，这意味着当前页面需要关闭，会调用当前页面的`beforeunload`事件。此事件使网页能够触发一个确认对话框，询问用户是否真的要离开该页面。如果用户确认，浏览器将导航到新页面，否则导航将会取消；

+ 浏览器判断用户输入URL是否合法，如果不合法，则调用默认的搜索引擎，来合成新的带搜索关键字的URL；

+ 如果输入内容是URL，浏览器检查请求是HTTPS还是HTTP，协议默认为http。有些情况下，第一个请求不是HTTPS的，但是当浏览器向网站发出第一个HTTP请求之后，网站会返回浏览器一个响应，请求浏览器使用HTTPS发送请求；

::: tip
完整的URL是由协议（比如http，ftp）、域名（比如`http://www.baidu.com`）、文件路径（比如/src/index.html这样的）和端口（比如:80）四个部分组成，如果内容不齐，协议默认为http，文件路径默认为空（虽然服务器接收到的是空的文件名，但是一般会在服务器端补全为index.html），端口默认为80端口。
:::

::: tip
HSTS（HTTP Strcit-Transport-Securit）的作用是强制客户端（如浏览器）使用HTTPS与服务器创建连接。服务器开启HSTS的方法是，当客户端通过HTTPS发出请求时，在服务器返回的超文本传输协议（HTTP）响应头中包含Strict-Transport-Security字段。非加密传输时设置的HSTS字段无效。这是一种 Web 安全策略机制，可保护网站免受协议降级攻击和 cookie 劫持、中间人攻击。
:::

::: tip
Chrome 浏览器关闭HSTS操作。地址栏中输入 chrome://net-internals/#hsts、在 Delete domain 中输入项目的域名，并Delete 删除、可以在 Query domain 测试是否删除成功
:::

### 即沿用当前页面协议，不要写死协议，这样有利于以后协议升级，比如http升级为https

## URL 请求过程

+ 浏览器进程会通过进程间通信（IPC）把 URL 请求发送至网络进程，网络进程接收到 URL 请求后，会在这里发起真正的 URL 请求流程

+ 网络进程查找浏览器缓存是否存在该资源，如果命中该资源且没有过期，直接返回资源给浏览器进程

+ 如果没有命中缓存资源，直接进入网络请求流程

+ DNS解析查找IP地址

+ TCP三次握手，浏览器连接服务器

+ 如果有重定向，返回第一步，重新发送请求

+ 如果是HTTPS协议，需要通过SSL协议，需要先进性SSL协议握手，如果有提交数据，数据加密传输给服务器

+ 服务器处理请求，服务器根据请求路径找到对应资源，然后通过请求头中的压缩、缓存等字段以及服务器自身支持内容生成响应头信息，返回给浏览器

## 浏览器渲染过程

+ 浏览器接受服务器相应

+ 构建dom树

+ 构建render树

+ 布局render树

+ 绘制render树

+ 连接结束，四次挥手

+ http 3

+ https为什么加载缓慢，解决方案

2、网站优化

+ dns预解析
+ 通过正确设置响应头来缓存JavaScript文件
+ 合并文件（减少http请求），将script标签放在body尾部（减少页面css，html的下载阻塞，减少界面的空白时间（浏览器在解析到script标签之前，不会渲染页面的任何部分））
+ 可通过CSS Sprite（又称CSS雪碧）—将多个图片整合到一个图片中
+ Minify把CSS和JS压缩和削减(Minify：去掉空格回车符等)
+ 按需加载：将不影响首屏的资源和当前屏幕资源不用的资源放到用户需要时才加载，可以大大提升重要资源的显示速度和降低总体流量
+ defer和async属性：都是并行下载，下载过程不阻塞，区别在于执行时机，async是下载完成后立即执行；defer是等页面加载完成后再执行。defer仅当src属性声明时才生效（HTML5的规范）
+ 控制 JavaScript 包的大小，面向移动设备时尤其要注意。较小的包可提升下载速度、降低内存使用率并减少 CPU 开销
+ 不要只做一个大包；如果你的包大小超过 50-100kB，就把它拆分成几个小包。（通过 HTTP/2 多路复用可以同时传输多个请求和响应消息，从而减少额外请求的开销。）
+ 通过正确设置响应头来缓存JavaScript文件
+ 减少重绘和重排： 在修改样式的过程中，最好避免使用下面的属性,因为它们会刷新渲染队列，尽量少查询下列属性
+ 合并多次对DOM和样式的修改
+ cookie http-only
+ 使用for循环
+ 若我们要访问最外层的变量（全局变量），则相比直接访问内部的变量而言，会带来比较大的性能损耗。因此，我们可以将经常使用的全局变量引用储存在一个局部变量里
+ 避免使用with，try-catch，eval等动态作用域语句
+ 使用事件委托来减少事件处理器的数量
+ 把递归算法改用迭代算法实现是避免调用栈溢出错误的解决方法之一
+ 免重复性工作，手动实现缓存（Vue源码中就有很多缓存）
+ 避免使用闭包
+ 使用http2
+ 服务器PWA service worker
+ Web Worker
+ WebAssembly
+ 服务器渲染
+ 图片懒加载
+ 骨架屏
