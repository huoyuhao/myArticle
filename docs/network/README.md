
# 从输入URL到页面展示

从URL到页面展示都经历了那些内容？我先把结果放出来，之后在一章一章的具体介绍相应的知识点


## 用户输入
+ 用户输入内容，点击回车，这意味着当前页面需要关闭，会调用当前页面的`beforeunload`事件。此事件使网页能够触发一个确认对话框，询问用户是否真的要离开该页面。如果用户确认，浏览器将导航到新页面，否则导航将会取消；

+ 浏览器判断用户输入URL是否合法，如果不合法，则调用默认的搜索引擎，来合成新的带搜索关键字的URL；

+ 如果输入内容是URL，浏览器检查请求是HTTPS还是HTTP，协议默认为http。有些情况下，第一个请求不是HTTPS的，但是当浏览器向网站发出第一个HTTP请求之后，网站会返回浏览器一个响应，请求浏览器使用HTTPS发送请求；

::: tip
完整的URL是由协议（比如http，ftp）、域名（比如http://www.baidu.com）、文件路径（比如/src/index.html这样的）和端口（比如:80）四个部分组成，如果内容不齐，协议默认为http，文件路径默认为空（虽然服务器接收到的是空的文件名，但是一般会在服务器端补全为index.html），端口默认为80端口。
:::

::: tip
HSTS（HTTP Strcit-Transport-Securit）的作用是强制客户端（如浏览器）使用HTTPS与服务器创建连接。服务器开启HSTS的方法是，当客户端通过HTTPS发出请求时，在服务器返回的超文本传输协议（HTTP）响应头中包含Strict-Transport-Security字段。非加密传输时设置的HSTS字段无效。这是一种 Web 安全策略机制，可保护网站免受协议降级攻击和 cookie 劫持、中间人攻击。
:::

::: tip
Chrome 浏览器关闭HSTS操作。地址栏中输入 chrome://net-internals/#hsts、在 Delete domain 中输入项目的域名，并Delete 删除、可以在 Query domain 测试是否删除成功
:::

**即沿用当前页面协议，不要写死协议，这样有利于以后协议升级，比如http升级为https**

## URL 请求过程
+ 浏览器进程会通过进程间通信（IPC）把 URL 请求发送至网络进程，网络进程接收到 URL 请求后，会在这里发起真正的 URL 请求流程

+ 网络进程查找浏览器缓存是否存在该资源，如果命中该资源且没有过期，直接返回资源给浏览器进程

+ 如果没有命中缓存资源，直接进入网络请求流程

+ DNS解析查找IP地址

+ TCP三次握手，浏览器连接服务器

+ 如果有重定向，返回第一步，重新发送请求

+ 如果是HTTPS协议，需要通过SSL协议，需要先进性SSL协议握手，如果有提交数据，数据加密传输给服务器

+ 服务器处理请求，服务器根据请求路径找到对应资源，然后通过请求头中的压缩、缓存等字段以及服务器自身支持内容生成响应头信息，返回给浏览器



## 浏览器渲染过程
+ 浏览器接受服务器相应

+ 构建dom树

+ 构建render树

+ 布局render树

+ 绘制render树

+ 连接结束，四次挥手

