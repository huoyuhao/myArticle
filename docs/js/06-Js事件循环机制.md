---
meta:
  - name: description
    content: JavaScript事件循环机制
  - name: keywords
    content: JavaScript事件循环机制,事件循环机制,JavaScript,前端,学习,Event Loop
---
# JavaScript事件循环机制

## 微任务/宏任务介绍

### 宏任务（macro-task）

| # |　浏览器 | node |
| -- | -- | -- |
| I/O | 是 | 是 |
| setTimeout | 是 | 是 |
| setInterval | 是 | 是 |
| setImmediate | - | 是 |
| requestAnimationFrame | 是 | - |

:::tip
requestAnimationFrame是浏览器用于定时循环操作的一个接口，类似于setTimeout，主要用途是按帧对网页进行重绘。

`window.requestAnimationFrame(callback)`

更多内容参看文章[requestAnimationFrame详解以及无线页面优化](http://caibaojian.com/requestanimationframe.html)
:::

### 微任务（micro-task）

| # |　浏览器 | node |
| -- | -- | -- |
| process.nextTick | - | 是 |
| MutationObserver | 是 | - |
| Promise.then catch finally | 是 | 是 |

:::tip
MutationObserver 给开发者们提供了一种能在某个范围内的 DOM 树发生变化时作出适当反应的能力。该 API 设计用来替换掉在 DOM 3 事件规范中引入的 Mutation 事件。

更多内容参看文章[深入 MutationObserver](https://juejin.im/entry/57de3fc30bd1d00057f2ea33)
:::

## 循环机制


![EvenLoop](/img/EvenLoop-1.png)

![EvenLoop](/img/EvenLoop-2.png)

在事件循环中，每进行一次循环操作称为 tick，每一次 tick 的任务处理模型是比较复杂的，但关键步骤如下：

+ 执行一个宏任务（栈中没有就从事件队列中获取）
+ 执行过程中如果遇到微任务，就将它添加到微任务的任务队列中
+ 宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）
+ 当前宏任务执行完毕，开始检查渲染，然后GUI线程接管渲染
+ 渲染完毕后，JS线程继续接管，开始下一个宏任务（从事件队列中获取）

## 参考文章


